--[[
    Nexus UI Library - Cyberpunk Edition
    Fully working • Smooth drag • Neon glow • 2025 ready
    Loadstring: loadstring(game:HttpGet("https://raw.githubusercontent.com/YourName/NexusUI/main/source.lua"))()
]]

local Nexus = {}
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local Players = game:GetService("Players")

local Player = Players.LocalPlayer

-- // Theme
local Theme = {
    Background = Color3.fromRGB(10, 10, 20),
    Secondary = Color3.fromRGB(20, 20, 35),
    Accent = Color3.fromRGB(0, 255, 255),
    Accent2 = Color3.fromRGB(255, 0, 255),
    Text = Color3.fromRGB(240, 240, 255),
    TextSecondary = Color3.fromRGB(170, 170, 200),
    Success = Color3.fromRGB(80, 255, 150),
    Stroke = Color3.fromRGB(50, 50, 80),
}

-- // Utility
local function Tween(obj, props, duration)
    TweenService:Create(obj, TweenInfo.new(duration or 0.2, Enum.EasingStyle.Quart), props):Play()
end

local function Create(class, props)
    local inst = Instance.new(class)
    inst.BorderSizePixel = 0
    for i, v in pairs(props) do
        if i ~= "Parent" then
            inst[i] = v
        end
    end
    if props.Parent then inst.Parent = props.Parent end
    return inst
end

local function AddStroke(obj, thickness, color)
    local stroke = Create("UIStroke", {
        Color = color or Theme.Stroke,
        Thickness = thickness or 1,
        Parent = obj
    })
    return stroke
end

local function AddCorner(obj, radius)
    Create("UICorner", { CornerRadius = UDim.new(0, radius or 8), Parent = obj })
end

-- // Draggable
local function MakeDraggable(frame, handle)
    handle = handle or frame
    local dragging = false
    local dragInput, mousePos, framePos

    handle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            mousePos = input.Position
            framePos = frame.Position

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    handle.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement and dragging then
            local delta = input.Position - mousePos
            Tween(frame, {Position = UDim2.new(framePos.X.Scale, framePos.X.Offset + delta.X, framePos.Y.Scale, framePos.Y.Offset + delta.Y)}, 0.1)
        end
    end)
end

-- // Main Function
function Nexus:CreateLib(title, config)
    config = config or {}
    local Window = {}

    local ScreenGui = Create("ScreenGui", {
        Name = "NexusUI_" .. HttpService:GenerateGUID(false),
        Parent = CoreGui,
        ResetOnSpawn = false
    })

    local Main = Create("Frame", {
        Size = config.Size or UDim2.new(0, 600, 0, 480),
        Position = UDim2.new(0.5, -300, 0.5, -240),
        BackgroundColor3 = Theme.Background,
        Parent = ScreenGui
    })
    AddCorner(Main, 12)
    AddStroke(Main, 2, Theme.Accent)

    local Glow = Create("Frame", {
        Size = UDim2.new(1, 20, 1, 20),
        Position = UDim2.new(0, -10, 0, -10),
        BackgroundTransparency = 0.8,
        BackgroundColor3 = Theme.Accent,
        ZIndex = -1,
        Parent = Main
    })
    AddCorner(Glow, 16)

    local Topbar = Create("Frame", {
        Size = UDim2.new(1, 0, 0, 45),
        BackgroundColor3 = Theme.Secondary,
        Parent = Main
    })
    AddCorner(Topbar, 12)

    local Gradient = Create("UIGradient", {
        Color = ColorSequence.new{
            ColorSequenceKeypoint.new(0, Theme.Accent),
            ColorSequenceKeypoint.new(1, Theme.Accent2)
        },
        Rotation = 90,
        Parent = Topbar
    })

    Create("TextLabel", {
        Size = UDim2.new(1, -100, 1, 0),
        Position = UDim2.new(0, 15, 0, 0),
        BackgroundTransparency = 1,
        Text = title or "Nexus Hub",
        TextColor3 = Theme.Text,
        TextSize = 16,
        Font = Enum.Font.GothamBold,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = Topbar
    })

    local Close = Create("TextButton", {
        Size = UDim2.new(0, 30, 0, 30),
        Position = UDim2.new(1, -40, 0.5, -15),
        BackgroundColor3 = Color3.fromRGB(255, 80, 80),
        Text = "X",
        TextColor3 = Color3.new(1,1,1),
        Font = Enum.Font.GothamBold,
        Parent = Topbar
    })
    AddCorner(Close, 8)
    Close.MouseButton1Click:Connect(function()
        ScreenGui:Destroy()
    end)

    MakeDraggable(Main, Topbar)

    local Sidebar = Create("Frame", {
        Size = UDim2.new(0, 160, 1, -55),
        Position = UDim2.new(0, 0, 0, 55),
        BackgroundColor3 = Theme.Secondary,
        Parent = Main
    })
    AddCorner(Sidebar, 10)

    local Content = Create("ScrollingFrame", {
        Size = UDim2.new(1, -170, 1, -65),
        Position = UDim2.new(0, 165, 0, 55),
        BackgroundTransparency = 1,
        CanvasSize = UDim2.new(0, 0, 0, 0),
        ScrollBarThickness = 5,
        Parent = Main
    })

    local ListLayout = Create("UIListLayout", {
        Padding = UDim.new(0, 8),
        FillDirection = Enum.FillDirection.Vertical,
        Parent = Content
    })

    local Tabs = {}
    local CurrentTab = nil

    function Window:NewTab(name)
        local Tab = {}
        local Button = Create("TextButton", {
            Size = UDim2.new(1, -20, 0, 40),
            Position = UDim2.new(0, 10, 0, #Tabs * 50 + 10),
            BackgroundColor3 = CurrentTab == Tab and Theme.Accent or Theme.Secondary,
            Text = "  " .. name,
            TextColor3 = Theme.Text,
            TextSize = 14,
            Font = Enum.Font.GothamSemibold,
            TextXAlignment = Enum.TextXAlignment.Left,
            Parent = Sidebar
        })
        AddCorner(Button, 8)

        local Container = Create("Frame", {
            Size = UDim2.new(1, 0, 1, 0),
            BackgroundTransparency = 1,
            Visible = false,
            Parent = Content
        })

        local SectionLayout = Create("UIListLayout", {
            Padding = UDim.new(0, 10),
            Parent = Container
        })

        Button.MouseButton1Click:Connect(function()
            if CurrentTab then CurrentTab.Button.BackgroundColor3 = Theme.Secondary end
            CurrentTab = Tab
            Button.BackgroundColor3 = Theme.Accent
            for _, t in pairs(Tabs) do t.Container.Visible = false end
            Container.Visible = true
        end)

        if #Tabs == 0 then Button.MouseButton1Click:Fire() end
        table.insert(Tabs, {Button = Button, Container = Container})

        function Tab:NewSection(sectionName)
            local Section = {}
            local Frame = Create("Frame", {
                Size = UDim2.new(1, -20, 0, 50),
                BackgroundColor3 = Theme.Secondary,
                Parent = Container
            })
            AddCorner(Frame, 10)
            AddStroke(Frame, 1)

            Create("TextLabel", {
                Size = UDim2.new(1, 0, 0, 30),
                BackgroundTransparency = 1,
                Text = sectionName,
                TextColor3 = Theme.Accent,
                TextSize = 15,
                Font = Enum.Font.GothamBold,
                TextXAlignment = Enum.TextXAlignment.Left,
                Position = UDim2.new(0, 10,0,0),
                Parent = Frame
            })

            local Elements = Create("Frame", {
                Size = UDim2.new(1, -20, 1, -40),
                Position = UDim2.new(0, 10, 0, 35),
                BackgroundTransparency = 1,
                Parent = Frame
            })

            local Layout = Create("UIListLayout", {
                Padding = UDim.new(0, 6),
                Parent = Elements
            })

            Layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
                Frame.Size = UDim2.new(1, -20, 0, Layout.AbsoluteContentSize.Y + 50)
            end)

            -- Toggle
            function Section:NewToggle(options)
                options = options or {}
                local state = options.Default or false

                local Toggle = Create("Frame", {
                    Size = UDim2.new(1, 0, 0, 30),
                    BackgroundTransparency = 1,
                    Parent = Elements
                })

                Create("TextLabel", {
                    Size = UDim2.new(1, -60, 1, 0),
                    BackgroundTransparency = 1,
                    Text = options.Name or "Toggle",
                    TextColor3 = Theme.Text,
                    TextSize = 13,
                    Font = Enum.Font.Gotham,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    Parent = Toggle
                })

                local Box = Create("Frame", {
                    Size = UDim2.new(0, 40, 0, 20),
                    Position = UDim2.new(1, -50, 0.5, -10),
                    BackgroundColor3 = state and Theme.Success or Theme.Stroke,
                    Parent = Toggle
                })
                AddCorner(Box, 10)

                local Check = Create("Frame", {
                    Size = UDim2.new(0, 14, 0, 14),
                    Position = UDim2.new(0.5, -7, 0.5, -7),
                    BackgroundColor3 = Color3.new(1,1,1),
                    Visible = state,
                    Parent = Box
                })
                AddCorner(Check, 4)

                Toggle.InputBegan:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 then
                        state = not state
                        Tween(Box, {BackgroundColor3 = state and Theme.Success or Theme.Stroke}, 0.2)
                        Check.Visible = state
                        if options.Callback then options.Callback(state) end
                    end
                end)

                return {
                    Set = function(val)
                        state = val
                        Tween(Box, {BackgroundColor3 = val and Theme.Success or Theme.Stroke}, 0.2)
                        Check.Visible = val
                    end
                }
            end

            -- Button
            function Section:NewButton(options)
                local Button = Create("TextButton", {
                    Size = UDim2.new(1, 0, 0, 35),
                    BackgroundColor3 = Theme.Accent,
                    Text = options.Name or "Button",
                    TextColor3 = Color3.new(0,0,0),
                    TextSize = 14,
                    Font = Enum.Font.GothamBold,
                    Parent = Elements
                })
                AddCorner(Button, 8)

                Button.MouseButton1Click:Connect(function()
                    spawn(options.Callback or function() end)
                end)
            end

            -- Slider (simple)
            function Section:NewSlider(options)
                local Slider = Create("Frame", {
                    Size = UDim2.new(1, 0, 0, 50),
                    BackgroundTransparency = 1,
                    Parent = Elements
                })

                Create("TextLabel", {
                    Size = UDim2.new(1, 0, 0, 20),
                    BackgroundTransparency = 1,
                    Text = (options.Name or "Slider") .. ": " .. (options.Default or 50),
                    TextColor3 = Theme.Text,
                    TextSize = 13,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    Parent = Slider
                })

                local Bar = Create("Frame", {
                    Size = UDim2.new(1, 0, 0, 8),
                    Position = UDim2.new(0, 0, 0, 25),
                    BackgroundColor3 = Theme.Stroke,
                    Parent = Slider
                })
                AddCorner(Bar, 4)

                local Fill = Create("Frame", {
                    Size = UDim2.new((options.Default or 50)/100, 0, 1, 0),
                    BackgroundColor3 = Theme.Accent,
                    Parent = Bar
                })
                AddCorner(Fill, 4)

                local Value = options.Default or 50

                local dragging = false
                Bar.InputBegan:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 then
                        dragging = true
                    end
                end)
                UserInputService.InputEnded:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 then
                        dragging = false
                    end
                end)
                UserInputService.InputChanged:Connect(function(input)
                    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                        local mouseX = input.Position.X
                        local barX = Bar.AbsolutePosition.X
                        local percent = math.clamp((mouseX - barX) / Bar.AbsoluteSize.X, 0, 1)
                        Value = math.floor(options.Min or 0 + percent * ((options.Max or 100) - (options.Min or 0)))
                        Fill.Size = UDim2.new(percent, 0, 1, 0)
                        Slider.TextLabel.Text = (options.Name or "Slider") .. ": " .. Value
                        if options.Callback then options.Callback(Value) end
                    end
                end)
            end

            return Section
        end

        return Tab
    end

    -- Toggle UI
    UserInputService.InputBegan:Connect(function(input)
        if input.KeyCode == (config.ToggleKey or Enum.KeyCode.Insert) then
            ScreenGui.Enabled = not ScreenGui.Enabled
        end
    end)

    return Window
end

return Nexus
